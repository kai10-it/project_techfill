# 2025-7-10

# 作業内容
## コードスタイルの修正
- 20250620055622_create_users_table.rb のコードスタイルを修正
  - `t.timestamps` を追加
- 20250626013149_drop_comments_table.rb のコードスタイルを修正
  - ブロックを追加してロールバックに対応
- routes.rb のコードスタイルを修正
  - 不要な空行を削除
  - `#`とコメントの間に空白を追加
- users.rb のコードスタイルを修正
  - インデントの幅を統一
  - ファイル末尾に改行を追加
- user_spec.rb のコードスタイルを修正
  - インデントの幅を統一
  - ファイル末尾に改行を追加
- application_system_test_case.rb のコードスタイルを修正
  - 配列の中に余計なスペースを削除
- articles_controller.rb のコードスタイルを修正
  - `html_safe` による XSS 脆弱性を修正
 
## RuboCopのルールを設定
- Style/Documentationのルールの設定を変更
  - `test/application_system_test_case.rb`を`Exclude`に追加
  - `test/controllers/homes_controller_test.rb`を`Exclude`に追加
  - `test/test_helper.rb`を`Exclude`に追加

# 振り返り
## 学び・気づき
- マイグレーションでテーブルを削除する処理を行った際、単にテーブルを削除するだけでは不十分であることに気づいた。
万が一ロールバックが必要になった場合、削除されたテーブルのカラム定義がマイグレーションファイルに残っていなければ、元の状態に復元できずエラーになる可能性がある。
そのため、テーブルを削除するマイグレーションでは、復元（ロールバック）に備えて削除前のテーブル構造も定義しておくことが重要であると学んだ。
- `html_safe`の仕様がXSS（クロスサイトスクリプティング）脆弱性に繋がるため、不用意な使用は避ける必要がある。
今回のようにユーザーが入力する内容に`html_safe`を適用することはは危険である。
- Ruby on Railsの仕様では、文字列に含まれるHTMLタグはエスケープ（無効化）になる。つまり、タグがただの文字列として扱われHTMLに反映させることはない。
この仕様があることで、ユーザーが悪意のあるスクリプトを仕込んでも動かないようにしている。
- `htmle_safe`を使用することで、文字列のエスケープしていたHTMLタグを有効にすることができる。
- XSS(クロスサイトスクリプティング)とは、ユーザーがWebページを見たときに、意図しないJavaScriptなどが実行されてしまう攻撃のこと。
これが危険な理由は、アカウントの乗っ取りやなりすまし、フィッシング、マルウェア配布といったことが可能になってしまうため。
- XSS対策のために、`sanitize()`がある。これを使用することで、危険なタグや属性を除去して安全にHTMLを表示することができるようにする。
- また、`content_tag()`という方法もある。こちらは指定したタグで文字列を表示することができるメソッドである。
引数となる文字列は自動でエスケープされるため、危険なスクリプトが実行されることなくただの文字列になる。
- rawはViewの文字列をエスケープさせずに、そのままHTMLとして表示させるメソッド。

# 現状の問題点
- コントローラーのアクションが長いものや複雑なものがあるため修正をする必要がある。
- メールアドレスをモデル側で重複しないように設定しているが、データベースには重複しない設定が反映されていないため修正をする必要がある。
## 今後の対応
- コントローラーのアクションの修正。
- データベースの設定を更新。
